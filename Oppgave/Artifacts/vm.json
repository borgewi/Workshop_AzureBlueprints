{
    "kind": "template",
    "properties": {
        "template": {
            "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "parameters": {
                "storageAccountName": {
                    "type": "string"
                },
                "pipName": {
                    "type": "string"
                },
                "vnetName": {
                    "type": "string"
                },
                "networkInterfacesName": {
                    "type": "string"
                },
                "virtualMachineName": {
                    "type": "string"
                },
                "vmUsername": {
                    "type": "string"
                },
                "vmPassword": {
                    "type": "string"
                },
                "location": {
                    "type": "string"
                }
            },
            "resources": [
            {    
                "type": "Microsoft.Compute/virtualMachines",
                "apiVersion": "2018-10-01",
                "name": "[parameters('virtualMachineName')]",
                "location": "[parameters('location')]",
                "properties": {
                    "hardwareProfile": {
                        "vmSize": "Standard_B2ms"
                    },
                    "storageProfile": {
                        "imageReference": {
                            "publisher": "microsoftvisualstudio",
                            "offer": "visualstudio2019",
                            "sku": "vs-2019-ent-ws2019",
                            "version": "latest"
                        },
                        "osDisk": {
                            "osType": "Windows",
                            "name": "[concat(parameters('virtualMachineName'), '_OsDisk_1_16bf91455b6f465589f145a9f400054f')]",
                            "createOption": "FromImage",
                            "caching": "ReadWrite",
                            "managedDisk": {
                                "storageAccountType": "Premium_LRS"
                            },
                            "diskSizeGB": 127
                        },
                        "dataDisks": []
                    },
                    "osProfile": {
                        "computerName": "[parameters('virtualMachineName')]",
                        "adminUsername": "[parameters('vmUsername')]",
                        "adminPassword": "[parameters('vmPassword')]",
                        "windowsConfiguration": {
                            "provisionVMAgent": true,
                            "enableAutomaticUpdates": true
                        },
                        "secrets": [],
                        "allowExtensionOperations": true
                    },
                    "networkProfile": {
                        "networkInterfaces": [
                            {
                                "id": "[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfacesName'))]"
                            }
                        ]
                    },
                    "diagnosticsProfile": {
                        "bootDiagnostics": {
                            "enabled": true,
                            "storageUri": "[concat('https://', parameters('storageAccountName'), '.blob.core.windows.net/')]"
                        }
                    }
                }
            }
        ]
        },
        "resourceGroup": "Blueprint-RG",
        "parameters": {
            "storageAccountName": {
                "value": "[parameters('BP_storageAccountName')]"
            },
            "pipName": {
                "value": "[parameters('BP_pipName')]"
            },
            "vnetName": {
                "value": "[parameters('BP_vnetName')]"
            },
            "networkInterfacesName": {
                "value": "[parameters('BP_networkInterfaceName')]"
            },
            "virtualMachineName": {
                "value": "[parameters('BP_virtualMachineName')]"
            },
            "vmUsername":{
                "value": "[parameters('BP_vmUsername')]"
            },
            "vmPassword":{
                "value": "[parameters('BP_vmPass')]"
            },
            "location": {
                "value": "[parameters('BP_location')]"
            }
        },
        "dependsOn": [
            "nic",
            "storageaccount",
            "vnet",
            "pip"
        ]
    },
    "type": "Microsoft.Blueprint/blueprints/artifacts"
}